name: "Log Session Insights"
description: "Capture session summary with decisions, patterns, and potential ADRs"
aliases: ["log", "ls"]

args:
  - name: "topic"
    short: "t"
    description: "Brief topic or project name for this session"
    type: "string"
    required: false
  - name: "adr"
    short: "a"
    description: "Flag this session as containing ADR-worthy decisions"
    type: "flag"

steps:
  - name: "Create log directory"
    run: |
      mkdir -p .claude/session-logs

  - name: "Generate session summary"
    ask_claude: |
      Analyze our conversation and create a structured summary for future reference.
      ${topic:+The topic is: $topic}
      ${adr:+Pay special attention to architectural decisions that might warrant ADRs.}

      Focus on:
      1. Key technical decisions made and their rationale
      2. Trade-offs considered
      3. Patterns or best practices identified
      4. Problems solved and approaches taken
      5. Potential improvements or follow-up items
      6. Any decisions that might warrant formal ADRs

      Format the output as markdown with these sections:
      - Summary (2-3 sentences)
      - Key Decisions (with rationale and trade-offs)
      - Technical Insights (patterns, gotchas, learnings)
      - Code Patterns (reusable patterns identified)
      - Potential ADRs (decisions needing formal documentation)
      - Follow-up Items (unresolved questions, future improvements)

      Be specific and include concrete examples where relevant.
      Focus on reusable insights rather than project-specific details.
    save_to_var: "session_summary"

  - name: "Prepare log entry"
    run: |
      TIMESTAMP=$(date +"%Y-%m-%d")
      FILENAME=".claude/session-logs/${TIMESTAMP}.md"
      TIME=$(date +"%H:%M")
      
      # Create header for new file
      if [ ! -f "$FILENAME" ]; then
        echo "# Session Log - ${TIMESTAMP}" > "$FILENAME"
        echo "" >> "$FILENAME"
      fi
      
      # Add entry
      echo "## [${TIME}] - ${topic:-Untitled Session}" >> "$FILENAME"
      ${adr:+echo "ðŸ›ï¸ **Contains ADR-worthy decisions**" >> "$FILENAME"}
      echo "" >> "$FILENAME"
      echo "$session_summary" >> "$FILENAME"
      echo "" >> "$FILENAME"
      echo "---" >> "$FILENAME"
      echo "" >> "$FILENAME"
      
      echo "âœ… Session logged to $FILENAME"

  - name: "Show ADR extraction option"
    run: |
      if [ "$adr" = "true" ]; then
        echo ""
        echo "ðŸ“‹ To extract ADR template from this session:"
        echo "   ~/.claude/commands/extract-adr $FILENAME"
      fi